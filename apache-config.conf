<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Deny access to configuration files
        <FilesMatch "^(\.htaccess|\.htpasswd|composer\.json|composer\.lock)$">
            Require all denied
        </FilesMatch>
    </Directory>

    # Deny access to data directory (now outside document root)
    <Directory /srv/privatebin/data>
        Require all denied
    </Directory>

    # Deny access to other sensitive directories
    <Directory /srv/privatebin/cfg>
        Require all denied
    </Directory>

    <Directory /srv/privatebin>
        Require all denied
    </Directory>

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "DENY"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "no-referrer"
    Header always set Content-Security-Policy "default-src 'none'; base-uri 'self'; form-action 'none'; manifest-src 'self'; connect-src * blob:; script-src 'self' 'unsafe-eval'; style-src 'self'; font-src 'self'; frame-ancestors 'none'; img-src 'self' data: blob:; media-src blob:; object-src blob:; sandbox allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-downloads"

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
