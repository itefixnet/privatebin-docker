<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html

    # Disable server signature and version information
    ServerSignature Off
    ServerTokens Prod

    # Remove identifying headers
    Header unset Server
    Header unset X-Powered-By
    Header unset X-Forwarded-For
    Header unset Referer

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Deny access to configuration files (but not metrics.php since it's accessed via alias)
        <FilesMatch "^(\.htaccess|\.htpasswd|composer\.json|composer\.lock)$">
            Require all denied
        </FilesMatch>
    </Directory>

    # Metrics endpoint for Prometheus (access controlled via METRICS_ALLOWED_IPS env var)
    Alias /metrics /var/www/html/metrics.php
    
    # Block direct access to metrics.php file
    <Files metrics.php>
        Require all denied
    </Files>
    <Directory /srv/privatebin/data>
        Require all denied
    </Directory>

    # Deny access to other sensitive directories
    <Directory /srv/privatebin/cfg>
        Require all denied
    </Directory>

    <Directory /srv/privatebin>
        Require all denied
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    LogLevel crit
    CustomLog /dev/null combined
</VirtualHost>
